# 统计理论

## （一）常见分布

1. 正态分布

   变量的频数或者频率呈现出中间最多，两端逐渐对称减少的一种分布规律。例如：一个班的成绩分布情况。

2. 伯努利分布

   一个事件有发生和不发生两种取值1,0。这两种取值对应的概率为p,1-p。期望为p,方差为p(1-p)。 例如：抛一次硬币，正面朝上的概率。

3. 二项分布

   在n次独立重复的伯努利实验中，事件A恰好发生K次的概率。期望np 方差np(1-p)。 例如：抛十次硬币，硬币有五次正面朝上的概率。

4. 几何分布

   在伯努利实验中，事件A进行实验X次才第一次成功的概率。例如：射击十次才命中一次靶的概率。

5. 泊松分布

   观察事物单位时间内平均发生次数λ，实际发生次数K次的概率。概率为P 期望和方差都是 λ。 例如：在一个医院中，假设每个病人来看病的概率都是随机且独立的，那么这个医院在一天内接受的病人呈泊松分布。

6. 长尾分布

   从需求角度来看，大量需求会集中在头部，而个性化、零散性需求形成了长长的尾巴。 例如：将曲目按照下载量排序，可近似地得到一条递减曲线。在曲线的头部，热门曲目被大量下载。接下来，随着流行程度的降低，尾部曲线并没有迅速坠落到零，而是极其缓慢地贴近于横轴，这说明很不热门的曲日仍然保持着一定的下载率。这种特殊的排序（即排名）与下载量之间的对应关系就是长尾分布。

## （二）中心极限定理、大数定律、极大似然估计

1. 中心极限定理

   样本量足够大的前提下，则变量均值的分布将近似于正态分布，而与该变量在总体中的分布无关。

2. 大数定理

   如果统计的数据足够大，在实验条件不变的情况下，重复多次，随机事件的频率近似于它的概率。

3. 极大似然估计

   通过若干次试验，观察其结果，利用试验结果得到某个参数值能够使样本出现的概率为最大。最大似然估计的目的：利用已知的样本结果，反推最有可能（最大概率）导致这样结果的参数值。

## (三) 假设检验

1. 简单介绍

   1. 原理：对总体特征提出某种假设，通过抽样研究的统计推理，判断应该接受还是拒绝原假设。

   2. 思想：小概率事件不会在一次实验中发生。

   3. 目的：所测试的数据的均值等于目标均值的可能性。
   4. 过程
      1. 提出检验假设H0 代表我们需要推翻的假设，提出备择假设H1 代表我们需要接受的假设。
      2. 选定统计方法，计算p值。
      3. 选择显著性水平 0.05
      4. 根据P值分析结果 若P值小于显著性水平 代表原假设不成立 备择假设成立。 P值的大小一般可通过查阅相应的界值表得到。

2. 两类错误

   1. 定义

      + 第一类错误：也叫做α错误，代表原假设为真，但各个统计量结果拒绝原假设，.这个错误的概率记作α，这个值也是显著性水平。简称‘弃真’。
      + 第二类错误也叫做β错误，代表原假设为假，但各个统计量结果接受原假设，这个错误的概率记作β。简称‘取伪’。
      + P值是统计学中用于判断显著性的指标，统计量对应的概率值就是P值，也可以可以理解为原假设为真时，样本出现极端结果的概率，当P值小于α时，就代表原假设不成立，备择假设成立。

   2. 两类错误之间的关系

      + 样本量不变的情况下，α愈小，β愈大；反之，α愈大，β愈小。因而可通过选定α控制β大小。
      + 如果要同时减小α和β，只有增加样本量。
      + 第一类错误更严重，由于报告了本来不存在的现象，则因此现象而衍生出的后续研究、应用的危害将是不可估量的。

   3. 最小样本量

      通过显著性水平，统计功效，均值差异，以及标准差计算得到结果。

      + 显著性水平（α）：显著性水平是估计总体参数落在某一区间内，可能犯错误的概率。显著性水平越低，对实验结果的要求也就越高，越需要更大的样本量来确保精度。
      + 统计功效（1 – β）：统计功效意味着避免犯二类错误的概率，这个值越大，需要的样本量也越大。也叫做power。
      + 均值差异（μA-μB）：如果两个版本的均值差别巨大，也不太需要多少样本，就能达到统计显著。
      + 标准差（σ）：标准差越小，代表两组差异的趋势越稳定。越容易观测到显著的统计结果。

      以Z检验为例，n=2*（σ的平方）*（z（1-α/2）+z（1-β））的平方/（μA-μB）的平方。不同检验中，最小样本量公式不同。

   4. 置信区间和置信度

      + 置信区间可以理解为样本统计量所构造的总体参数的估计区间。
      + 置信度可以理解这个参数的真实值有多大把握落在这个区间内。

## （四）方差、协方差、相关系数

1. 方差

   用来刻画一个样本中数据的离散程度

2. 协方差

   刻画两个变量的变化趋势
   $$
   Cov(X,Y)=E(XY) - E(X)*E(Y)
   $$
   

3. 相关系数

   衡量两个变量线性相关关系

   
   $$
   r(X,Y)=\frac{Cov(X,Y)}{\sigma_X*\sigma_Y}
   $$
   相关性是协方差的标准化格式，协方差很难做比较，比如我们可以通过协方差判断年龄和收入是否是正相关还是负相关，但不能反映相关性的程度，因为相协方差没有考虑两个变量的量纲影响，因此可以通过相关系数来反应具体的相关程度。

## （五）幸存者偏差

​		所统计的数据全都来源于幸存的人，因为失败出局者根本没机会给出回答。可以这样理解，在幸存者偏差这个问题中，我们所观察的样本是被筛选过的有偏样本，比如在火车上采访别人是否购票。

## （六）辛普森悖论

1. 定义

   在某个条件下的两组数据，在分别讨论的时候会满足某种性质，一旦合并数据，可能会得到相反的结论。

   + 美国有两个学院A和B，这两个学院均是女生录取率大于男性，因此人们怀疑这两个学院有性别歧视。但合并之后统计总体女生的录取率却小于男性。

   + 研究之后发现：A学院的录取率很低，但是B学院的录取率很高；女性录取者集中在A学院，男性录取者集中在B学院。也就是说并非是这两个学院有性别歧视，而是男女生在专业上的分布不同，男性更倾向于选择B学院，女性更倾向于选择A学院。

2. 避免

   + 关注数据生成的过程，考虑因果模型，而不是只看重数据的结果。
   + 谨慎设置个别分组权重，并以一定的系数去消除分组数据差异的影响，同时也需要了解是否还有其他因素的影响。

## （七）检验方法

1. T检验

   + 用于两个样本平均值差异程度的检验方法，根据T分布理论来推断差异发生的概率，从而判定两个平均数差异是否显著。
   + 用于总体方差未知且N小于30的样本。

   + 单样本T检验、两独立样本T检验、两配对T检验

2. Z检验

   + 用标准正态分布的理论来推断差异发生的概率，从而比较两个平均数的差异是否显著。
   + Z检验适用于N大于30以上的样本或者总体方差已知且N小于30的样本。

3. 卡方检验

   卡方检验是检验两个变量之间有没有关系，基本思想是计算观察值和期望值之间的偏离程度。

4. 方差分析

   用于两样本或以上样本间的均数差别的显著性检验。

   | X数据类型 | X组别     | Y数据类型 | 分析方法 | 例子                               |
   | :-------: | --------- | --------- | -------- | ---------------------------------- |
   |   定类    | 2组或以上 | 定量      | 方差分析 | 不同收入X群体的身高Y是否有差异     |
   |   定类    | 仅仅2组   | 定量      | T检验    | 不同性别X群体的身高Y是否有差异     |
   |   定类    | 2组或以上 | 定类      | 卡方检验 | 不同性别X人群是否有抽烟Y的差异情况 |

5. 参数检验和非参数检验

   1. 定义

      + 参数检验：假设总体分布已知，根据样本数据对总体分布的统计参数进行推断。

      + 非参数检验：对总体无特殊要求，利用样本数据对总体分布形态进行推断。

   2. 区别与联系

      + 联系：参数检验和非参数检验都是统计分析方法的重要组成部分，共同构成统计推断的基本内容。

      + 区别：参数检验的前提是总体分布已知，非参数检验的前提是总体分布未知，一般来说参数检验的效果比非参数检验的效果好，但是实际情况中，我们很难了解清楚总体的分布。

## （八）贝叶斯定理

1. 贝叶斯定理

    A条件下事件B发生的概率和B条件下事件A发生的概率是不同的。但是这两者是有明确关系的。 支持某项属性的事件发生得愈多，则该属性成立的可能性就愈大。

2. 贝叶斯公式

    已知先验概率求后验概率
   $$
   P(A|B) = \frac{P(A)*P(B|A)}{P(B)}
   $$

## （九）AB测试

1. 定义

   + 对同一个问题，有多套解决方案，对同一组人群进行随机分组；
   + 在同一时间维度，进行实验组和对照组的实验，通过少量且相同的衡量指标，衡量哪套解决方案的结果表现更好，并采用。

2. 作用

   验证策略是否是可行有效的方法。

3.  原理

   通过运用假设检验对实验结果进行显著性分析。

4. 步骤

   背景：在搜索引擎中，如何评估新排序算法相较于旧的排序算法更好？

   

   1. 第一步，根据实验的目的提出假设，在这里可以提出两个命题。H0是旧排序算法的转化率高。H1是新排序算法的转化率高。H0是我们希望被推翻的命题，H1是我们希望被证实的命题。
   2. 第二步，确定实验对象，因为排序算法最终应用在搜索结果页，所以实验对象就是进入搜索页面的人群，A组的用户会看见旧的排序算法，B组的用户会看见新的排序算法。
   3. 第三步，确定实验条件，确定显著性水平，并计算相应的最小样本量。
   4. 第四步，确定实验指标，我们以转化率作为目标指标。
   5. 第五步，借助AB平台实施实验，沟通业务、产品、开发、上线实验并持续观察几天到半月甚至更长时间。
   6. 第六步：计算实验结果并输出结论，默认显著性水平α=0.05，结合假设检验公式计算P值。若P值小于0.05则推翻了H0假设，证明在0.05的显著性水平下，新算法的转化率更高。

5. 实验分流

   1. 方法

      一般实验分为正交实验和互斥实验两类，另外精细化运营的时候还会被经常用到的是圈层实验，具体如下：

      1. 互斥实验：指的是实验与实验共用一层流量，互相不产生交叉，类似实验1中3个实验组，实验3和实验4，共用一层流量。

      2. 正交实验：实验与实验分别用不同层的流量，不产生互相的干扰，即便另一层也在做实验，但那一层流量到了这一层也是均匀分配的，不影响这一层实验变量的唯一性。

      3. 圈层实验：通常受众比较大的增长点做完了，更多的会去做用户的精细化运营，满足某些群体没有被很好满足到的需求，以带来业务的增长，圈层实验在这个时候就可以起到很好的帮助。

         - 比如多日无播放行为的用户做一个圈层，做做引导或者Push；

         - 比如下载页无内容的用户做一个圈层，做做冷启时优质内容的推荐；

         - 比如某一兴趣标签的用户做一个圈层，提供更匹配的服务等等。

   2. 意义

      + 网页的流量是有限的，每天都会同时开展大量的AB实验，合理的分层分流能够保证实验对象在同一层中不会互相干扰，也能避免流量饥渴问题。
      + 流量正交能够让关联度较小的实验同时进行，比如实验1是关于用户界面的实验，实验2是关于推荐算法的实验，关联度较弱，使用相同的流量不会对结果有太大影响；
      + 流量互斥能够让关联度较大的实验同时进行，比如实验1中实验组1测试颜色对按钮点击率的影响，实验1中实验组2想测试大小对按钮点击率的影响。

6. AB实验如何避免辛普森悖论

   分层试验，交叉试验，定向试验是我们规避辛普森悖论的有力工具。

   + 合理的进行正确的流量分割，保证试验组和对照组里的用户特征是一致的，并且都具有代表性，可以代表总体用户特征。
   + 在试验设计上，如果我们觉得某两个变量对试验结果都有影响，那我们就应该把这两个变量放在同一层进行互斥试验，不要让一个变量的试验动态影响另一个变量的检验。如果我们觉得一个试验可能会对新老客户产生完全不同的影响，那么就应该对新客户和老客户分别展开定向试验，观察结论。
   + 在试验实施上，对试验结果我们要积极的进行多维度的细分分析，除了总体对比，也看一看对细分受众群体的试验结果，不要以偏盖全，也不要以全盖偏。一个试验版本提升了总体活跃度，但是可能降低了年轻用户的活跃度，那么这个试验版本是不是更好呢？一个试验版本提升总营收0.1%，似乎不起眼，但是可能上海地区的年轻女性 iPhone 用户的购买率提升了20%，这个试验经验就很有价值了。

7. AB实验优缺点

   1. 优点

      + 数据驱动创新，数据驱动增长，A/B测试是其中核心的工具和引擎。A/B测试是一切决策的前提和基础，用数据说话。

      + 业务创新：通过持续的功能优化打磨，累积创新效果，逐步形成迄今最优的产品形态，同时可将优秀的功能模块抽象沉淀至通用化组件平台。

      + 收益提升：在电商/金融等交易相关产品中，通过优化交易链路可直接带来可观的经济收益。

      + 管理提效：通过A/B实验精准衡量新功能产出，为管理层提供准确的数据依据和科学度量。

   2. 缺点
      + 制作AB版本的开发、数据收集的工作量较大、以及后期维护成本增加，ROI低；
      + AB测试受场景限制，产品版本发布后，无法增加或更改AB测试场景；
      + 通常应用于短期即刻行为，不适用与需要很长时间才能验证的测试；
      + 需要的用户人数多，要有足够的样本量。

8. 应用场景

   + 产品UI

     不同行业的产品需要不同的风格，同时还要与企业的品牌相得益彰。利用A/B 测试优化UI能给用户带来更好的交互体验和视觉感受。

   + 文案内容

     顾名思义是指用户阅读到的文字内容——小到图片配文和按钮文字，大到文章标题甚至版块主题；这些部分都可以尝试变换文案内容，测试不同方案的数据效果。

   + 页面布局

     有些时候，可能根本不需要对产品的UI或是文案内容作出调整，只是在布局排版上的改变，就可以出现增长的效果。

   + 产品功能

     想给产品增加一个新功能，可是很难确定是否能达到用户的预期，如果盲目上线，可能会造成一些损失；使用A/B 测试，对你的用户真正负责；例如，社交类产品在付费查看照片的新功能正式上线前，需要进行A/B 测试，以验证功能的使用情况和效果。

   + 推荐算法

     包括基于内容的推荐算法（根据用户的历史记录推荐相似内容）、基于协同过滤的推荐算法（根据有相似兴趣用户的行为推荐相关内容）、基于关联规则的推荐算法（根据商品/内容本身的相关性给用户推荐）；算法优化迭代前，需要真实的数据进行测试。

   